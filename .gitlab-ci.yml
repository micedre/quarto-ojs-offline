variables:
  UV_VERSION: "0.9.25"
  PYTHON_VERSION: "3.12"
  BASE_LAYER: bookworm-slim
  # GitLab CI creates a separate mountpoint for the build directory,
  # so we need to copy instead of using hard links.
  UV_LINK_MODE: copy
  UV_SYSTEM_PYTHON: 1
  UV_DEFAULT_INDEX: "https://nexus.insee.fr/repository/pypi-public/simple"
  UV_NATIVE_TLS: true
  

stages:
  - deploy

  

pages:
  stage: deploy
  image: gitlab-registry.insee.fr/datascience/ls3/images/images-datascience-insee/onyxia-python-minimal:py3.13.11
  tags:
   - docker
  script:
    - echo "Installing Python dependencies for OJS offline extension using uv..."
    - uv --allow-insecure-host nexus.insee.fr  pip install requests  # Required for some download operations
    
    - echo "Running OJS offline setup to download libraries..."
    - cd _extensions/ojs-offline && uv run python setup.py
    - cd ../../
    
    - echo "Building Quarto project..."
    - uv run quarto render --to html --output-dir public

    - echo "Build completed successfully!"
  artifacts:
    paths: 
    - public/
  only:
    - main

