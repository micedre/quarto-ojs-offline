
stages:
  - test-docker
  - deploy


test-docker:
  stage: test-docker
  image: proxy-ghcr-io.insee.fr/quarto-dev/quarto-full:1.6.42
  script:
    - quarto --version
  

pages:
  stage: deploy
  image: proxy-ghcr-io.insee.fr/astral-sh/uv:0.9.18
  tags:
   - docker
  script:
    - echo "Installing Python dependencies for OJS offline extension using uv..."
    - uv pip install requests  # Required for some download operations
    
    - echo "Running OJS offline setup to download libraries..."
    - cd _extensions/ojs-offline && uv run python setup.py
    - cd ../../
    
    - echo "Building Quarto project..."
    - uv run --with quarto quarto render --to html --output-dir public
    
    - echo "Build completed successfully!"
  artifacts:
    paths: 
    - public/
  only:
    - main

